<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#00E5B0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="signight">
  <meta name="description" content="Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§ ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Ù¾ÛŒØ´Ø±ÙØªÙ‡">
  
  <title>signight</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <h1>
        <img src="icons/icon-96.png" alt="signight" style="width:22px;height:22px;object-fit:contain;display:inline-block;vertical-align:middle;">
        signight
      </h1>
      <div class="header-actions">
        <div class="status-bar">
          <span class="status-dot"></span>
          <span id="lastUpdate">--:--</span>
        </div>
        <button id="installBtn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Ù†ØµØ¨
        </button>
      </div>
    </header>
    
    <!-- Update Banner -->
    <div class="update-banner" id="updateBanner" aria-live="polite">
      <div class="update-text">Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª</div>
      <div class="update-actions">
        <button id="updateRefreshBtn" class="update-btn">Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
        <button id="updateDismissBtn" class="update-dismiss" aria-label="Ø¨Ø³ØªÙ† Ø§Ø¹Ù„Ø§Ù† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ">Ã—</button>
      </div>
    </div>
    
    <!-- Search Box -->
    <div class="search-box">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
      <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù†Ù…Ø§Ø¯... (Ù…Ø«Ù„ BTC, ETH, DOGE)">
      <div class="search-results" id="searchResults"></div>
    </div>
    
    <!-- Watchlist Tabs -->
    <div class="tabs" id="watchlistTabs">
      <!-- Generated by JS -->
    </div>
    
    <!-- Capital Settings -->
    <div class="capital-box">
      <div class="capital-row-main">
        <div class="capital-field">
          <label>
            <svg viewBox="0 0 24 24" fill="none" stroke="#00E5B0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="16"></line>
              <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
            Ø³Ø±Ù…Ø§ÛŒÙ‡ (USDT)
          </label>
          <input type="number" id="capitalInput" value="1000" min="1">
        </div>
        <div class="capital-field">
          <label>
            <svg viewBox="0 0 24 24" fill="none" stroke="#00E5B0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="20" x2="12" y2="10"></line>
              <line x1="18" y1="20" x2="18" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
            Ø¯Ø±ØµØ¯ ÙˆØ±ÙˆØ¯
          </label>
          <select id="riskPercent">
            <option value="10">10%</option>
            <option value="20">20%</option>
            <option value="30">30%</option>
            <option value="50">50%</option>
            <option value="100">100%</option>
          </select>
        </div>
        <div class="capital-field">
          <label>
            <svg viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
            Ø§Ù‡Ø±Ù… (Leverage)
          </label>
          <select id="leverageSelect">
            <option value="auto">Ø®ÙˆØ¯Ú©Ø§Ø±</option>
            <option value="1">1x</option>
            <option value="2">2x</option>
            <option value="3">3x</option>
            <option value="5">5x</option>
            <option value="7">7x</option>
            <option value="10">10x</option>
            <option value="15">15x</option>
            <option value="20">20x</option>
            <option value="25">25x</option>
            <option value="50">50x</option>
            <option value="75">75x</option>
            <option value="100">100x</option>
            <option value="125">125x</option>
          </select>
        </div>
        <div class="capital-amount">
          <span class="amount-label">Ù…Ø¨Ù„Øº ÙˆØ±ÙˆØ¯:</span>
          <span class="amount-value" id="entryAmount">$100</span>
        </div>
      </div>
      <div class="capital-row-secondary">
        <div class="capital-field">
          <label>
            <svg viewBox="0 0 24 24" fill="none" stroke="#00E5B0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 20V10"></path>
              <path d="M18 20V4"></path>
              <path d="M6 20v-4"></path>
            </svg>
            Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ
          </label>
          <select id="strategySelect">
            <option value="default">Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ù…ØªÙˆØ§Ø²Ù†)</option>
            <option value="conservative">Ù…Ø­Ø§ÙØ¸Ù‡â€ŒÚ©Ø§Ø±Ø§Ù†Ù‡</option>
            <option value="trend_following">Ù¾ÛŒØ±ÙˆÛŒ Ø§Ø² Ø±ÙˆÙ†Ø¯</option>
          </select>
        </div>
        <div class="capital-field notification-field">
          <label>
            <svg viewBox="0 0 24 24" fill="none" stroke="#00E5B0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            Ø§Ø¹Ù„Ø§Ù†
          </label>
          <label class="switch">
            <input type="checkbox" id="notificationToggle" checked>
            <span class="slider"></span>
          </label>
        </div>
        <button class="save-btn" id="saveSettings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          Ø°Ø®ÛŒØ±Ù‡
        </button>
      </div>
    </div>
    
    <!-- View Tabs -->
    <div class="view-tabs">
      <button class="view-tab" data-view="scanner" id="tabScanner">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
        </svg>
        Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª
      </button>
      <button class="view-tab active" data-view="signal" id="tabSignal">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
        Ø¬Ø²Ø¦ÛŒØ§Øª
      </button>
      <button class="view-tab" data-view="chart" id="tabChart">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="20" x2="18" y2="10"></line>
          <line x1="12" y1="20" x2="12" y2="4"></line>
          <line x1="6" y1="20" x2="6" y2="14"></line>
        </svg>
        Ù†Ù…ÙˆØ¯Ø§Ø±
      </button>
      <button class="view-tab" data-view="analysis" id="tabAnalysis">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
          <path d="M2 17l10 5 10-5"></path>
          <path d="M2 12l10 5 10-5"></path>
        </svg>
        Ù…ÙˆØªÙˆØ± ØªØ­Ù„ÛŒÙ„Ú¯Ø±
      </button>
    </div>
    
    <!-- Signal View (Asset Panel) -->
    <div class="view-content active" id="viewSignal">
      <div class="asset-panel" id="assetPanel">
        <div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
      </div>
    </div>
    
    <!-- Chart View -->
    <div class="view-content" id="viewChart">
      <div class="chart-container">
        <div class="chart-header">
          <span class="chart-title" id="chartTitle">Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚ÛŒÙ…Øª</span>
          <div class="chart-controls">
            <button class="chart-btn active" id="btnEMA" onclick="toggleChartIndicator('ema')">EMA</button>
            <button class="chart-btn active" id="btnBB" onclick="toggleChartIndicator('bb')">BB</button>
            <button class="chart-btn active" id="btnVolume" onclick="toggleChartIndicator('volume')">Vol</button>
            <button class="chart-btn" onclick="resetChartView()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="chart-wrapper">
          <canvas id="priceChart"></canvas>
        </div>
        <div class="chart-timeframes">
          <button class="tf-btn" data-tf="30m">30m</button>
          <button class="tf-btn active" data-tf="1h">1H</button>
          <button class="tf-btn" data-tf="4h">4H</button>
          <button class="tf-btn" data-tf="1d">1D</button>
        </div>
      </div>
    </div>
    
    <!-- Suggestions View (Auto Scanner) -->
    <div class="view-content" id="viewScanner">
      <div class="scanner-container">
        <!-- Header with timer -->
        <div class="suggestions-header" style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;border:1px solid var(--border);">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div style="display:flex;align-items:center;gap:10px;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--teal)" stroke-width="2">
                <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
              </svg>
              <span style="color:var(--text1);font-weight:600;font-size:16px;">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯</span>
            </div>
          </div>
          <p style="margin:10px 0 0;font-size:13px;color:var(--text2);">Û±Û² Ù†Ù…Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡ â€¢ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± Û±Û° Ø«Ø§Ù†ÛŒÙ‡</p>
        </div>
        
        <!-- Results list -->
        <div id="scannerResults" style="display:none;">
          <div id="scannerResultsList"></div>
        </div>
        
        <!-- No results state -->
        <div id="noSuggestionsState" style="display:none;text-align:center;padding:60px 20px;color:var(--text2);">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin:0 auto 20px;opacity:0.5;">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          <h3 style="margin:0 0 10px;color:var(--text1);">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
          <p style="margin:0 0 20px;font-size:14px;">Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù‚ÙˆÛŒ Ø¨Ø§ Ø§Ù…ØªÛŒØ§Ø² Û¶+ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
          <button onclick="startAutoSuggestions()" style="background:var(--card);color:var(--text1);border:1px solid var(--border);padding:10px 24px;border-radius:8px;font-size:14px;cursor:pointer;font-family:inherit;">
            Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø¬Ø¯Ø¯
          </button>
        </div>
      </div>
    </div>
    
    <!-- Analysis Engine View -->
    <div class="view-content" id="viewAnalysis">
      <div class="analysis-container">
        <!-- Header -->
        <div class="analysis-header" style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;border:1px solid var(--border);">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <div style="display:flex;align-items:center;gap:10px;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--teal)" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5"></path>
                <path d="M2 12l10 5 10-5"></path>
              </svg>
              <span style="color:var(--text1);font-weight:600;font-size:16px;">Ù…ÙˆØªÙˆØ± ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</span>
            </div>
          </div>
          <div style="display:flex;gap:12px;flex-wrap:wrap;">
            <div style="flex:1;min-width:120px;">
              <label style="display:block;font-size:12px;color:var(--text2);margin-bottom:6px;">Ø¬ÙØª Ø§Ø±Ø²</label>
              <select id="analysisSymbol" style="width:100%;padding:8px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;color:var(--text1);font-family:inherit;font-size:14px;">
                <option value="BTC/USDT">BTC/USDT</option>
                <option value="ETH/USDT">ETH/USDT</option>
                <option value="BNB/USDT">BNB/USDT</option>
                <option value="SOL/USDT">SOL/USDT</option>
              </select>
            </div>
            <div style="flex:1;min-width:120px;">
              <label style="display:block;font-size:12px;color:var(--text2);margin-bottom:6px;">ØµØ±Ø§ÙÛŒ</label>
              <select id="analysisExchange" style="width:100%;padding:8px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;color:var(--text1);font-family:inherit;font-size:14px;">
                <option value="binance">Binance</option>
                <option value="okx">OKX</option>
                <option value="bybit">Bybit</option>
              </select>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;margin-top:12px;">
            <div id="engineStatus" style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text2);">
              <div style="width:8px;height:8px;border-radius:50%;background:var(--text3);"></div>
              <span>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆØªÙˆØ±...</span>
            </div>
          </div>
          <button id="runAnalysisBtn" onclick="runAnalysis()" style="width:100%;margin-top:8px;padding:12px;background:var(--teal);color:#000;border:none;border-radius:8px;font-weight:600;font-size:15px;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;" disabled>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            Ø§Ø¬Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„
          </button>
        </div>

        <!-- Loading State -->
        <div id="analysisLoading" style="display:none;text-align:center;padding:40px 20px;background:var(--card);border-radius:12px;border:1px solid var(--border);">
          <div style="width:40px;height:40px;border:3px solid var(--teal);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px;"></div>
          <p style="color:var(--text2);font-size:14px;">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø±...</p>
        </div>

        <!-- Error State -->
        <div id="analysisError" style="display:none;background:rgba(239,68,68,0.12);border:1px solid rgba(239,68,68,0.5);color:#fecaca;border-radius:12px;padding:16px;margin-bottom:16px;">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <span style="font-weight:600;">Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„</span>
          </div>
          <p id="analysisErrorText" style="margin:0;font-size:13px;"></p>
        </div>

        <!-- Results -->
        <div id="analysisResults" style="display:none;">
          <!-- Scenario Card -->
          <div class="analysis-card" style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;border:1px solid var(--border);">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
              <h3 style="margin:0;color:var(--text1);font-size:16px;font-weight:600;">Ø³Ù†Ø§Ø±ÛŒÙˆ</h3>
              <span id="scenarioPriority" class="priority-badge" style="padding:4px 12px;border-radius:6px;font-size:11px;font-weight:600;"></span>
            </div>
            <p id="scenarioMessage" style="margin:0 0 8px;color:var(--text1);font-size:15px;font-weight:500;line-height:1.6;"></p>
            <p id="scenarioDetails" style="margin:0;color:var(--text2);font-size:13px;line-height:1.5;"></p>
          </div>

          <!-- Score Card -->
          <div class="analysis-card" style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;border:1px solid var(--border);">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
              <h3 style="margin:0;color:var(--text1);font-size:16px;font-weight:600;">Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„ÛŒ</h3>
              <span id="overallScore" style="font-size:24px;font-weight:700;color:var(--teal);"></span>
            </div>
            <div style="background:var(--bg2);border-radius:8px;height:8px;overflow:hidden;margin-bottom:8px;">
              <div id="scoreBar" style="background:var(--teal);height:100%;transition:width 0.5s;border-radius:8px;"></div>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--text2);">
              <span>0</span>
              <span>50</span>
              <span>100</span>
            </div>
          </div>

          <!-- Momentum Card -->
          <div class="analysis-card" style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;border:1px solid var(--border);">
            <h3 style="margin:0 0 12px;color:var(--text1);font-size:16px;font-weight:600;">ÙˆØ¶Ø¹ÛŒØª Ù…ÙˆÙ…Ù†ØªÙˆÙ…</h3>
            <div id="momentumStatus" style="display:flex;align-items:center;gap:10px;">
              <span style="font-size:18px;font-weight:600;"></span>
            </div>
          </div>

          <!-- Timeframe Results -->
          <div class="analysis-card" style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;border:1px solid var(--border);">
            <h3 style="margin:0 0 12px;color:var(--text1);font-size:16px;font-weight:600;">Ù†ØªØ§ÛŒØ¬ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…â€ŒÙ‡Ø§</h3>
            <div id="timeframeResults" style="display:grid;gap:10px;"></div>
          </div>

          <!-- Liquidity Walls -->
          <div class="analysis-card" style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;border:1px solid var(--border);">
            <h3 style="margin:0 0 12px;color:var(--text1);font-size:16px;font-weight:600;">Ø¯ÛŒÙˆØ§Ø±Ù‡Ø§ÛŒ Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒ</h3>
            <div id="liquidityWalls" style="display:grid;gap:12px;">
              <div>
                <div style="font-size:12px;color:var(--text2);margin-bottom:8px;display:flex;align-items:center;gap:6px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <polyline points="19 12 12 19 5 12"></polyline>
                  </svg>
                  Ù…Ù‚Ø§ÙˆÙ…Øª (Ask Walls)
                </div>
                <div id="askWalls" style="display:flex;flex-direction:column;gap:6px;"></div>
              </div>
              <div>
                <div style="font-size:12px;color:var(--text2);margin-bottom:8px;display:flex;align-items:center;gap:6px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--teal)" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <polyline points="5 12 12 5 19 12"></polyline>
                  </svg>
                  Ø­Ù…Ø§ÛŒØª (Bid Walls)
                </div>
                <div id="bidWalls" style="display:flex;flex-direction:column;gap:6px;"></div>
              </div>
            </div>
          </div>

          <!-- Order Book Preview -->
          <div class="analysis-card" style="background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--border);">
            <h3 style="margin:0 0 12px;color:var(--text1);font-size:16px;font-weight:600;">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Order Book</h3>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
              <div>
                <div style="font-size:12px;color:var(--text2);margin-bottom:8px;">ÙØ±ÙˆØ´Ù†Ø¯Ú¯Ø§Ù† (Asks)</div>
                <div id="orderBookAsks" style="display:flex;flex-direction:column;gap:4px;font-size:12px;"></div>
              </div>
              <div>
                <div style="font-size:12px;color:var(--text2);margin-bottom:8px;">Ø®Ø±ÛŒØ¯Ø§Ø±Ø§Ù† (Bids)</div>
                <div id="orderBookBids" style="display:flex;flex-direction:column;gap:4px;font-size:12px;"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div id="analysisEmpty" style="text-align:center;padding:60px 20px;color:var(--text2);">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin:0 auto 20px;opacity:0.5;">
            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
            <path d="M2 17l10 5 10-5"></path>
            <path d="M2 12l10 5 10-5"></path>
          </svg>
          <h3 style="margin:0 0 10px;color:var(--text1);">Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„</h3>
          <p style="margin:0;font-size:14px;">Ø¬ÙØª Ø§Ø±Ø² Ùˆ ØµØ±Ø§ÙÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ùˆ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Â«Ø§Ø¬Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„Â» Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
        </div>
      </div>
    </div>
    
  </div>
  
    <!-- AI Advisor Sticky Section -->
    <div id="aiAdvisorSticky" style="display:none;position:sticky;bottom:0;left:0;right:0;z-index:100;background:var(--bg);border-top:1px solid var(--border);padding:8px 16px;box-shadow:0 -2px 10px rgba(0,0,0,0.1);">
      <button id="aiAdvisorButton" onclick="handleAIPromptClick(null)" style="width:100%;padding:10px 16px;background:#8b5cf6;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:13px;font-family:'Vazirmatn',sans-serif;display:flex;align-items:center;justify-content:center;gap:8px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
        Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±Ø§Ù…Ù¾Øª ØªØ­Ù„ÛŒÙ„
      </button>
  </div>
  
  <!-- Toast -->
  <div class="toast" id="toast"></div>
  
  <!-- External Libraries -->
  <!-- ccxt library for exchange data -->
  <script src="https://cdn.jsdelivr.net/npm/ccxt@4.0.0/dist/ccxt.browser.js"></script>
  <!-- technicalindicators library for technical analysis -->
  <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.1.0/dist/technicalindicators.min.js"></script>
  
  <!-- Scripts -->
  <script src="core.js"></script>
  <script src="chart.js"></script>
  <script src="app.js"></script>
  
  <!-- Analysis Engine Module -->
  <script type="module">
    // Wait for libraries to be available before loading the module
    function waitForLibraries(maxWait = 15000) {
      return new Promise((resolve, reject) => {
        const startTime = Date.now();
        const checkLibraries = () => {
          if (typeof ccxt !== 'undefined' && typeof technicalIndicators !== 'undefined') {
            console.log('Both libraries are loaded');
            resolve();
          } else if (Date.now() - startTime > maxWait) {
            reject(new Error('Timeout waiting for libraries to load. ccxt: ' + (typeof ccxt !== 'undefined' ? 'loaded' : 'not loaded') + ', technicalIndicators: ' + (typeof technicalIndicators !== 'undefined' ? 'loaded' : 'not loaded')));
          } else {
            setTimeout(checkLibraries, 100);
          }
        };
        checkLibraries();
      });
    }

    async function loadAnalysisEngine() {
      try {
        console.log('Waiting for libraries...');
        console.log('ccxt:', typeof ccxt !== 'undefined' ? 'loaded' : 'not loaded');
        console.log('technicalIndicators:', typeof technicalIndicators !== 'undefined' ? 'loaded' : 'not loaded');
        
        await waitForLibraries();
        console.log('Libraries loaded, importing AnalysisEngine...');
        
        const { AnalysisEngine } = await import('./analysis-engine.js');
        
        // Make AnalysisEngine available globally for use in app.js
        window.AnalysisEngine = AnalysisEngine;
        window.analysisEngineReady = true;
        
        // Dispatch event to notify that engine is ready
        window.dispatchEvent(new CustomEvent('analysisEngineReady'));
        
        console.log('Analysis Engine module loaded successfully');
      } catch (error) {
        console.error('Error loading Analysis Engine:', error);
        window.dispatchEvent(new CustomEvent('analysisEngineError', { detail: error }));
      }
    }

    // Start loading immediately
    loadAnalysisEngine();
    
    // Also listen for when libraries might be loaded later
    window.addEventListener('load', function() {
      if (typeof window.AnalysisEngine === 'undefined') {
        console.log('Retrying AnalysisEngine load after page load...');
        loadAnalysisEngine();
      }
    });
  </script>

  <!-- Analysis Engine UI Script -->
  <script>
    // Analysis Engine UI Functions
    let currentAnalysisEngine = null;
    let analysisEngineReady = false;

    // Wait for AnalysisEngine to be loaded
    async function waitForAnalysisEngine(maxWait = 10000) {
      const startTime = Date.now();
      
      while (typeof window.AnalysisEngine === 'undefined') {
        if (Date.now() - startTime > maxWait) {
          throw new Error('Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆØªÙˆØ± ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.');
        }
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      
      analysisEngineReady = true;
      return window.AnalysisEngine;
    }

    async function runAnalysis() {
      const symbol = document.getElementById('analysisSymbol').value;
      const exchange = document.getElementById('analysisExchange').value;
      const runBtn = document.getElementById('runAnalysisBtn');
      
      // Hide previous results/errors
      document.getElementById('analysisResults').style.display = 'none';
      document.getElementById('analysisError').style.display = 'none';
      document.getElementById('analysisEmpty').style.display = 'none';
      document.getElementById('analysisLoading').style.display = 'block';
      
      // Disable button
      runBtn.disabled = true;
      runBtn.innerHTML = '<div style="width:18px;height:18px;border:2px solid currentColor;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;"></div> Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...';

      try {
        // Wait for AnalysisEngine to be available
        if (typeof window.AnalysisEngine === 'undefined') {
          runBtn.innerHTML = '<div style="width:18px;height:18px;border:2px solid currentColor;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;"></div> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆØªÙˆØ±...';
          await waitForAnalysisEngine(15000); // Wait up to 15 seconds
        }
        
        if (typeof window.AnalysisEngine === 'undefined') {
          throw new Error('Ù…ÙˆØªÙˆØ± ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.');
        }

        // Create engine instance
        currentAnalysisEngine = new window.AnalysisEngine(exchange, symbol);
        await currentAnalysisEngine.initialize();
        
        // Run analysis
        const result = await currentAnalysisEngine.analyze();

        if (!result.success) {
          throw new Error(result.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„');
        }

        // Display results
        displayAnalysisResults(result);

      } catch (error) {
        console.error('Analysis error:', error);
        showAnalysisError(error.message || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ Ø¯Ø± ØªØ­Ù„ÛŒÙ„');
      } finally {
        // Hide loading, enable button
        document.getElementById('analysisLoading').style.display = 'none';
        runBtn.disabled = false;
        runBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg> Ø§Ø¬Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„';
      }
    }

    function displayAnalysisResults(result) {
      // Show results container
      document.getElementById('analysisResults').style.display = 'block';
      document.getElementById('analysisEmpty').style.display = 'none';

      // Display scenario
      const scenario = result.scenario;
      document.getElementById('scenarioMessage').textContent = scenario.message;
      document.getElementById('scenarioDetails').textContent = scenario.details;
      
      // Set priority badge
      const priorityBadge = document.getElementById('scenarioPriority');
      priorityBadge.textContent = scenario.priority === 'high' ? 'Ø¨Ø§Ù„Ø§' : scenario.priority === 'medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù¾Ø§ÛŒÛŒÙ†';
      priorityBadge.style.background = scenario.priority === 'high' ? 'rgba(239,68,68,0.2)' : 
                                       scenario.priority === 'medium' ? 'rgba(255,214,0,0.2)' : 
                                       'rgba(156,163,175,0.2)';
      priorityBadge.style.color = scenario.priority === 'high' ? '#fecaca' : 
                                  scenario.priority === 'medium' ? '#fef3c7' : 
                                  '#d1d5db';

      // Display overall score
      const score = result.overallScore;
      document.getElementById('overallScore').textContent = score;
      document.getElementById('scoreBar').style.width = score + '%';
      
      // Color code score
      const scoreElement = document.getElementById('overallScore');
      if (score >= 70) {
        scoreElement.style.color = 'var(--teal)';
        document.getElementById('scoreBar').style.background = 'var(--teal)';
      } else if (score >= 40) {
        scoreElement.style.color = 'var(--yellow)';
        document.getElementById('scoreBar').style.background = 'var(--yellow)';
      } else {
        scoreElement.style.color = 'var(--red)';
        document.getElementById('scoreBar').style.background = 'var(--red)';
      }

      // Display momentum
      const momentumStatus = document.getElementById('momentumStatus');
      const momentum = result.timeframeResults['1h']?.momentum || result.timeframeResults[Object.keys(result.timeframeResults)[0]]?.momentum || 'Neutral';
      momentumStatus.innerHTML = `
        <span style="font-size:18px;font-weight:600;color:${momentum === 'Increasing' ? 'var(--teal)' : momentum === 'Decreasing' ? 'var(--red)' : 'var(--text2)'};">
          ${momentum === 'Increasing' ? 'ğŸ“ˆ Ø§ÙØ²Ø§ÛŒØ´ÛŒ' : momentum === 'Decreasing' ? 'ğŸ“‰ Ú©Ø§Ù‡Ø´ÛŒ' : 'â¡ï¸ Ø®Ù†Ø«ÛŒ'}
        </span>
        <span style="color:var(--text2);font-size:14px;">${momentum}</span>
      `;

      // Display timeframe results
      const timeframeContainer = document.getElementById('timeframeResults');
      timeframeContainer.innerHTML = '';
      
      const timeframes = ['30m', '1h', '4h', '1d'];
      timeframes.forEach(tf => {
        const tfData = result.timeframeResults[tf];
        if (!tfData) return;

        const scoreData = result.scores.find(s => s.timeframe === tf);
        const score = scoreData ? scoreData.score : 50;

        const tfCard = document.createElement('div');
        tfCard.style.cssText = 'background:var(--bg2);border-radius:8px;padding:12px;border:1px solid var(--border);';
        tfCard.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <span style="font-weight:600;color:var(--text1);">${tf}</span>
            <span style="font-size:20px;font-weight:700;color:var(--teal);">${Math.round(score)}</span>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:12px;">
            <div>
              <span style="color:var(--text2);">RSI:</span>
              <span style="color:var(--text1);margin-right:4px;">${tfData.rsi.toFixed(1)}</span>
            </div>
            <div>
              <span style="color:var(--text2);">ADX:</span>
              <span style="color:var(--text1);margin-right:4px;">${tfData.adx.toFixed(1)}</span>
            </div>
          </div>
          <div style="margin-top:8px;font-size:11px;color:var(--text2);">
            Ø±ÙˆÙ†Ø¯: <span style="color:var(--text1);">${tfData.trend === 'strong_up' ? 'ØµØ¹ÙˆØ¯ÛŒ Ù‚ÙˆÛŒ' : tfData.trend === 'strong_down' ? 'Ù†Ø²ÙˆÙ„ÛŒ Ù‚ÙˆÛŒ' : 'Ø®Ù†Ø«ÛŒ'}</span>
          </div>
        `;
        timeframeContainer.appendChild(tfCard);
      });

      // Display liquidity walls
      const walls = result.walls;
      
      // Ask walls (resistance)
      const askWallsContainer = document.getElementById('askWalls');
      askWallsContainer.innerHTML = '';
      if (walls.asks && walls.asks.length > 0) {
        walls.asks.slice(0, 5).forEach(wall => {
          const wallEl = document.createElement('div');
          wallEl.style.cssText = 'background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:6px;padding:8px;display:flex;justify-content:space-between;align-items:center;';
          wallEl.innerHTML = `
            <span style="color:var(--text1);font-weight:500;">${wall.price.toFixed(2)}</span>
            <span style="color:var(--red);font-size:11px;">${wall.strength.toFixed(1)}x</span>
          `;
          askWallsContainer.appendChild(wallEl);
        });
      } else {
        askWallsContainer.innerHTML = '<span style="color:var(--text3);font-size:12px;">Ø¯ÛŒÙˆØ§Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</span>';
      }

      // Bid walls (support)
      const bidWallsContainer = document.getElementById('bidWalls');
      bidWallsContainer.innerHTML = '';
      if (walls.bids && walls.bids.length > 0) {
        walls.bids.slice(0, 5).forEach(wall => {
          const wallEl = document.createElement('div');
          wallEl.style.cssText = 'background:rgba(0,229,176,0.1);border:1px solid rgba(0,229,176,0.3);border-radius:6px;padding:8px;display:flex;justify-content:space-between;align-items:center;';
          wallEl.innerHTML = `
            <span style="color:var(--text1);font-weight:500;">${wall.price.toFixed(2)}</span>
            <span style="color:var(--teal);font-size:11px;">${wall.strength.toFixed(1)}x</span>
          `;
          bidWallsContainer.appendChild(wallEl);
        });
      } else {
        bidWallsContainer.innerHTML = '<span style="color:var(--text3);font-size:12px;">Ø¯ÛŒÙˆØ§Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</span>';
      }

      // Display order book preview
      const orderBook = result.orderBook;
      
      // Asks
      const asksContainer = document.getElementById('orderBookAsks');
      asksContainer.innerHTML = '';
      if (orderBook.asks && orderBook.asks.length > 0) {
        orderBook.asks.slice(0, 5).forEach(ask => {
          const askEl = document.createElement('div');
          askEl.style.cssText = 'display:flex;justify-content:space-between;color:var(--red);';
          askEl.innerHTML = `<span>${ask.price.toFixed(2)}</span><span>${ask.amount.toFixed(4)}</span>`;
          asksContainer.appendChild(askEl);
        });
      }

      // Bids
      const bidsContainer = document.getElementById('orderBookBids');
      bidsContainer.innerHTML = '';
      if (orderBook.bids && orderBook.bids.length > 0) {
        orderBook.bids.slice(0, 5).forEach(bid => {
          const bidEl = document.createElement('div');
          bidEl.style.cssText = 'display:flex;justify-content:space-between;color:var(--teal);';
          bidEl.innerHTML = `<span>${bid.price.toFixed(2)}</span><span>${bid.amount.toFixed(4)}</span>`;
          bidsContainer.appendChild(bidEl);
        });
      }
    }

    function showAnalysisError(message) {
      document.getElementById('analysisError').style.display = 'block';
      document.getElementById('analysisErrorText').textContent = message;
      document.getElementById('analysisLoading').style.display = 'none';
      document.getElementById('analysisResults').style.display = 'none';
    }

    // Listen for AnalysisEngine ready event
    window.addEventListener('analysisEngineReady', function() {
      console.log('AnalysisEngine is ready!');
      analysisEngineReady = true;
      window.analysisEngineReady = true;
      
      // Update status indicator
      const statusEl = document.getElementById('engineStatus');
      if (statusEl) {
        statusEl.innerHTML = '<div style="width:8px;height:8px;border-radius:50%;background:var(--teal);"></div><span style="color:var(--teal);">Ù…ÙˆØªÙˆØ± Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª</span>';
      }
      
      // Enable button if it exists
      const runBtn = document.getElementById('runAnalysisBtn');
      if (runBtn) {
        runBtn.disabled = false;
        runBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg> Ø§Ø¬Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„';
      }
    });
    
    // Listen for AnalysisEngine error event
    window.addEventListener('analysisEngineError', function(event) {
      console.error('AnalysisEngine loading error:', event.detail);
      const statusEl = document.getElementById('engineStatus');
      if (statusEl) {
        statusEl.innerHTML = '<div style="width:8px;height:8px;border-radius:50%;background:var(--red);"></div><span style="color:var(--red);">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆØªÙˆØ±</span>';
      }
    });

    // Listen for AnalysisEngine error event
    window.addEventListener('analysisEngineError', function(event) {
      console.error('AnalysisEngine loading error:', event.detail);
      const errorMsg = document.getElementById('analysisErrorText');
      if (errorMsg) {
        showAnalysisError('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆØªÙˆØ± ØªØ­Ù„ÛŒÙ„Ú¯Ø±: ' + (event.detail?.message || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ'));
      }
    });

    // Check if AnalysisEngine is ready when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Wait a bit and check again
      setTimeout(function() {
        if (typeof window.AnalysisEngine !== 'undefined') {
          analysisEngineReady = true;
          console.log('AnalysisEngine already loaded');
        } else {
          console.log('AnalysisEngine not yet loaded, waiting...');
        }
      }, 1000);
    });
  </script>

  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .analysis-card {
      transition: all 0.2s ease;
    }
    
    .analysis-card:hover {
      border-color: var(--teal) !important;
    }
    
    #runAnalysisBtn:hover:not(:disabled) {
      background: var(--teal-dark) !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 229, 176, 0.3);
    }
    
    #runAnalysisBtn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }
  </style>
</body>
</html>
